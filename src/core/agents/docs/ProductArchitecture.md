# OneUnlimited 多代理系统产品架构

## 1. 概述

OneUnlimited 多代理系统 (Multi-Agent System, MAS) 是 OneUnlimited VSCode 扩展的核心功能之一，它允许多个专业化 AI 代理协作处理复杂的开发任务。每个代理专注于特定领域的技能，并通过协调机制共同工作，以完成超出单个代理能力范围的任务。

## 2. 业务目标

- 提高 AI 辅助开发的效率和质量
- 支持更复杂的开发任务和工作流
- 提供专业化的领域知识和技能
- 实现自动化的任务分解和协作
- 保持可扩展性以适应不同类型的项目需求

## 3. 系统架构

### 3.1 核心组件

```
┌──────────────────────────────────────────────────────────────┐
│                     OneUnlimited 多代理系统                          │
│                                                              │
│  ┌────────────────┐       ┌─────────────────────────────┐    │
│  │                │       │      代理管理器              │    │
│  │   团队领导代理  │◄─────►│   AgentManager.ts          │    │
│  │                │       │                             │    │
│  └────────────────┘       └─────────────────────────────┘    │
│          ▲                                                   │
│          │                                                   │
│          ▼                                                   │
│  ┌───────────────────────────────────────────────────────┐   │
│  │                     消息总线                           │   │
│  │               MessageBus.ts                           │   │
│  └───────────────────────────────────────────────────────┘   │
│          ▲                    ▲                   ▲          │
│          │                    │                   │          │
│          ▼                    ▼                   ▼          │
│  ┌────────────────┐   ┌────────────────┐   ┌────────────────┐│
│  │   专业代理 1    │   │   专业代理 2    │   │   专业代理 n    ││
│  │ (如: UI设计师)  │   │ (如: 前端开发)  │   │ (如: 测试工程师)││
│  └────────────────┘   └────────────────┘   └────────────────┘│
│                                                              │
└──────────────────────────────────────────────────────────────┘
           ▲                                      ▲
           │                                      │
           ▼                                      ▼
┌─────────────────────┐               ┌────────────────────────┐
│                     │               │                        │
│   VSCode API 集成    │               │     工具执行系统        │
│                     │               │                        │
└─────────────────────┘               └────────────────────────┘
```

### 3.2 组件描述

1. **团队领导代理 (TeamLeaderAgent)**
   - 分析和分解用户任务
   - 创建任务执行计划
   - 分配任务给专业代理
   - 监控任务执行进度
   - 整合各代理结果

2. **代理管理器 (AgentManager)**
   - 管理代理的生命周期
   - 动态加载和注册代理
   - 维护代理目录
   - 处理代理配置

3. **消息总线 (MessageBus)**
   - 处理代理间通信
   - 实现发布-订阅模式
   - 消息路由和过滤
   - 消息历史记录

4. **专业代理 (Specialized Agents)**
   - 专注于特定技能领域
   - 实现特定任务处理逻辑
   - 与其他代理协作

5. **VSCode API 集成**
   - 与 VSCode 扩展 API 交互
   - 访问工作区文件
   - 管理编辑器视图
   - 处理用户交互

6. **工具执行系统**
   - 执行代理请求的工具
   - 安全权限管理
   - 结果收集和返回

## 4. 代理类型与职责

### 4.1 代理类型

| 代理类型 | 主要职责 | 技能领域 |
|---------|---------|---------|
| 团队领导 (TeamLeader) | 任务分解与协调 | 系统规划、任务管理 |
| 架构师 (Architect) | 系统设计与技术选型 | 架构设计、技术评估 |
| UI 设计师 (UIDesigner) | 用户界面设计 | UI/UX、设计系统 |
| 前端开发 (FrontendDev) | 客户端实现 | HTML/CSS/JS、前端框架 |
| 后端开发 (BackendDev) | 服务器端实现 | API设计、数据管理 |
| 测试工程师 (QATester) | 质量保证 | 自动化测试、性能测试 |
| 数据库专家 (DatabaseExpert) | 数据结构与管理 | 数据库设计、优化 |
| DevOps 工程师 (DevOpsEngineer) | 部署与运维 | CI/CD、容器化 |

### 4.2 扩展性

系统设计为可扩展的架构，允许轻松添加新的代理类型。新代理只需:
1. 继承 BaseAgent 类
2. 实现指定的接口方法
3. 在代理目录中注册

## 5. 通信与协作模型

### 5.1 消息类型

- **任务分配 (TaskAssignment)**: 从团队领导到专业代理
- **状态更新 (StatusUpdate)**: 从专业代理到团队领导
- **信息请求 (InformationRequest)**: 代理间的信息查询
- **信息响应 (InformationResponse)**: 对信息请求的回应
- **通知 (Notification)**: 系统范围的广播消息

### 5.2 协作模式

1. **层级模式**: 团队领导统筹全局，专业代理处理特定任务
2. **点对点模式**: 代理间可直接通信获取信息
3. **发布-订阅模式**: 代理可订阅特定主题的消息

## 6. 用户界面与交互

### 6.1 系统视图

- **代理控制面板**: 查看和控制活跃代理
- **任务监控视图**: 跟踪任务执行进度
- **消息交流视图**: 查看代理间通信
- **结果展示视图**: 显示任务执行结果

### 6.2 用户交互流程

1. 用户提交任务描述
2. 团队领导分析并展示任务计划
3. 用户可选择性审核和修改计划
4. 系统执行任务，实时显示进度
5. 完成后，显示结果并允许用户提供反馈

## 7. 集成与部署

### 7.1 与 OneUnlimited 扩展集成

- 作为 OneUnlimited 核心模块集成
- 共享 VSCode 工作区上下文
- 利用 OneUnlimited 已有的工具执行框架
- 共享 AI 模型和 API 资源

### 7.2 部署考量

- 代理系统启动与扩展激活同步
- 代理状态与 VSCode 工作区关联
- 代理配置存储在用户设置中
- 可选择性启用/禁用特定代理

## 8. 未来扩展方向

- **代理学习能力**: 从用户反馈中改进
- **自定义代理**: 用户定义专业代理
- **代理市场**: 社区共享专业代理
- **跨项目代理记忆**: 保留项目相关知识
- **多语言支持**: 多语言代理间协作
